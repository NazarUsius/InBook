{% extends "base/_base.html" %}
{% load mention_tag %}

{% block content %}
<h1>{{ community.name }}</h1>
<p>{{ community.description }}</p>

<p><strong>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏:</strong></p>
<ul>
  {% for admin in community.admins.all %}
    <li>{{ admin.username }}</li>
  {% endfor %}
</ul>

<p><strong>–£—á–∞—Å–Ω–∏–∫—ñ–≤:</strong> {{ community.members.count }}</p>

{% if user.is_authenticated %}
  {% if is_member %}
    <form method="post" action="{% url 'community_leave' community.pk %}">
      {% csrf_token %}
      <button type="submit">–ü–æ–∫–∏–Ω—É—Ç–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç—É</button>
    </form>
  {% else %}
    <form method="post" action="{% url 'community_join' community.pk %}">
      {% csrf_token %}
      <button type="submit">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏</button>
    </form>
  {% endif %}
{% endif %}

{% if is_admin %}
  <hr>
  <p>
    <a href="{% url 'community_edit' community.pk %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a> |
    <a href="{% url 'community_delete' community.pk %}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
  </p>
{% endif %}

<hr>

<h2>–ü–æ—Å—Ç–∏ —Å–ø—ñ–ª—å–Ω–æ—Ç–∏</h2>

{% if posts %}
  {% for post in posts %}
    <div class="card mb-4">
      <div class="card-body">
        <h5>{{ post.title }}</h5>
        <p>{{ post.content }}</p>
        <small>–ê–≤—Ç–æ—Ä: {{ post.author.username }} | {{ post.created_at|date:"d.m.Y H:i" }}</small>

        <hr>

        <div>
          <strong>{{ post.title }}</strong> ‚Äî {{ post.author.username }} <br>

          <form method="post" action="{% url 'post_like' post.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm {% if user in post.likes.all %}btn-success{% else %}btn-outline-success{% endif %}">
              üëç {{ post.likes.count }}
            </button>
          </form>

          <form method="post" action="{% url 'post_dislike' post.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm {% if user in post.dislikes.all %}btn-danger{% else %}btn-outline-danger{% endif %}">
              üëé {{ post.dislikes.count }}
            </button>
          </form>
        </div>

        <hr>
        <h6>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h6>
        {% for comment in post.comments.all %}
          <div class="mb-2">
            <strong>{{ comment.author.username }}</strong>: <p>{{ comment.content|render_mentions }}</p>
            <small class="text-muted">({{ comment.created_at|date:"SHORT_DATETIME_FORMAT" }})</small>
          </div>
        {% empty %}
          <p class="text-muted">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —â–µ –Ω–µ–º–∞—î.</p>
        {% endfor %}

        {% if is_member %}
          <form method="post" class="mt-2">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <input type="hidden" name="post_id" value="{{ post.id }}">
            <button type="submit" class="btn btn-primary btn-sm">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
          </form>
        {% endif %}
      </div>
    </div>
  {% endfor %}
{% else %}
  <p>–ü–æ–∫–∏ –Ω–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤.</p>
{% endif %}

<a href="{% url 'communities_list' %}">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</a>
{% endblock %}
